{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% load humanize %}
{% block css %}
<link rel="stylesheet" href="{% static 'css/form.css' %}">
{% endblock css %}
{% block content %}
<div class="detail-wrapper wrapper" style="margin-top: 100px;">
  <!-- ì´ë¯¸ì§€ ë°°ë„ˆ -->
  <div class="image-banner p-5" style="background-image: url('{{ hobby.image.url }}'); height:300px; ">
    <span class="badge bg-danger mx-1" style="height:20px">{{ accepted|length }}ëª… ì°¸ì—¬ì¤‘</span>
    <span class="badge bg-dark mx-1" style="height:20px">{{ hobby.tags }}</span>
  </div>
  <!-- ë³¸ë¬¸ -->
  <div class="transup">
    <div class="card py-0">
      <a href="{% url 'accounts:detail' hobby.host.pk %}"><div class="circle-box">
        {% if hobby.host.image %}
        <img class="circle-image" src="{{ hobby.host.image.url }}" alt="">
        {% else %}
        <img class="circle-image" src="{% static 'image/default_profile_img.jpg' %}" alt="">
        {% endif %}
        <p class="text-center text-muted">{{ hobby.host }}</p>
      </div></a>
      <p class="circle-title">{{hobby.title}}</p>
    </div>
    <p class="text-center mt-3" style="font-size:16px;">
      â°
      {% if hobby.recruit_type %}
      ì˜¤í”„ë¼ì¸ {{ hobby.address }}
      {% else %}
      ì˜¨ë¼ì¸
      {% endif %}
      ğŸ“… {{ hobby.meeting_day|date:"m.d(l) A h:i" }}
    </p>
  </div>

  <pre class="detail-content">{{ hobby.content }}</pre>
  <!-- ì°¸ì—¬ ì¤‘ì¸ ìœ ì €  -->
  <ul id="accepted-user">
    <li class="detail-title">ë©¤ë²„ì†Œê°œ</li>
    <li class="detail-subtitle">ìš°ë¦¬ ë°˜ê°‘ê²Œ ë§Œë‚˜ìš”</li>
    {% for member in accepted %}
    <a href="{% url 'accounts:detail' member.user.pk %}"><li class="d-flex">
        {% if member.user.image %}
        <img class="member-image" src="{{ member.user.image.url }}" alt="">
        {% else %}
        <img class="member-image" src="https://dummyimage.com/80x80/000/fff" alt="">
        {% endif %}
        <p class="m-3">
          <span style="font-size:20px; font-weight:600;">{{ member.user }}</span><br>
          <span class="text-muted" style="overflow:hidden">ë©¤ë²„ ì†Œê°œê¸€</span>
        </p>
    </li></a>
    {% endfor %}
  </ul>
  <!-- ìŠ¹ì¸ ëŒ€ê¸° ë©¤ë²„ -->
  <ul>
    <li class="detail-title">ìŠ¹ì¸ ëŒ€ê¸° ë©¤ë²„</li>
    <li class="detail-subtitle d-flex justify-content-between">
      <span>í˜¸ìŠ¤íŠ¸ì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”</span>
      <span class="text-muted fs-6 member-more" type="button" id="offline-box" class="" data-bs-toggle="offcanvas"
      data-bs-target="#offcanvasBottom2" aria-controls="offcanvasBottom">ë”ë³´ê¸°ã€‹</span>
    </li>
    <li class="d-flex" style="overflow:hidden;">
      {% for member in waiting %}
        <a href="{% url 'accounts:detail' member.user.pk %}">
          {% if member.user.image %}
            <img class="member-image" src="{{ member.user.image.url }}" alt="">
          {% else %}
            <img class="member-image" src="https://dummyimage.com/80x80/000/fff" alt="">
          {% endif %}
        </a>
      {% endfor %}
    </li>
    <!-- í˜„ì¬ ìŠ¹ë½ ëŒ€ê¸°ì¤‘ì¸ ë©¤ë²„ -->
    <div class="offcanvas offcanvas-bottom" tabindex="-1" id="offcanvasBottom2">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="offcanvasBottomLabel">í˜¸ìŠ¤íŠ¸ì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <hr>
        <div class="offcanvas-body small">
          {% if waiting %}
            <ul class="" id="addrlist">
              {% for member in waiting %}
              <li class="d-flex justify-content-between"><a class="d-flex" href="{% url 'accounts:detail' member.user.pk %}">
                  {% if member.user.image %}
                  <img class="member-image" src="{{ member.user.image.url }}" alt="">
                  {% else %}
                  <img class="member-image" src="https://dummyimage.com/80x80/000/fff" alt="">
                  {% endif %}
                  <p class="m-3">
                    <span style="font-size:20px; font-weight:600;">{{ member.user }}</span><br>
                    <span class="text-muted" style="overflow:hidden">ë©¤ë²„ ì†Œê°œê¸€</span>
                  </p></a>
                  <div>
                    <a href="{% url 'hobby:approve' hobby.pk member.user.pk %}">ìŠ¹ì¸í•˜ê¸°</a>
                    <a href="{% url 'hobby:reject' hobby.pk member.user.pk %}">ê±°ì ˆí•˜ê¸°</a>
                  </div>
              </li>
              {% endfor %}
            </ul>
            {% else %}
            <div class="text-center mt-5">
                <p>
                    <ion-icon name="people" size="large"></ion-icon>
                </p>
                <h5>ì•„ì§ ì‹ ì²­í•œ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.</h5>
                <p class="text-muted">ì¡°ê¸ˆë§Œ ë” ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”!</p>
            </div>
            {% endif %}
        </div>
    </div>
  </ul>
  <!-- ì•ˆë‚´ì‚¬í•­ -->
  <ul>
    <li class="detail-title">ì•ˆë‚´ì‚¬í•­</li>
    <li class="detail-subtitle">ìì„¸í•œ ì •ë³´ë¥¼ ì•Œë ¤ë“œë¦´ê²Œìš”</li>
    <li>ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦ {{ hobby.limit }}ëª…</li>
    <li>ğŸ’µ {{ hobby.entry_fee }}ì›</li>
    <li>ğŸ“… {{ hobby.meeting_day|date:"m.d(l) A h:i" }}</li>
    <li>ğŸ—º {{ hobby.address }}</li>
    <!-- ì§€ë„ë„£ê¸° -->
    {% if hobby.address == ì˜¨ë¼ì¸ %}
    {% else %}
    {% endif %}
    <div id="map" style="width:100%;height:350px; border-radius:10px; border: solid 5px #e7e7e7"></div>
  </ul>

  <!-- ëŒ“ê¸€ -->
  <ul>
    <li class="detail-title">ì»¤ë®¤ë‹ˆí‹°</li>
    <li class="detail-subtitle">ì†Œì…œë§ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”</li>
    <li>
      <ion-icon name="heart-outline" size="large"></ion-icon>
      <ion-icon style="color:#E84545" name="heart" size="large"></ion-icon>
      <ion-icon name="chatbubble-outline" size="large"></ion-icon>
      <ion-icon name="ellipsis-horizontal"></ion-icon>
    </li>
    <!-- ëŒ“ê¸€ëª©ë¡ -->
    <li class="comment-elem">
      {% if user.image %}
        <img class="comment-image" src="{{ user.image.url }}" alt="">
      {% else %}
        <img class="comment-image" src="https://dummyimage.com/80x80/000/fff" alt="">
      {% endif %}
      <form id="comment-form" data-review-id="{{ review.pk }}" action="{% url 'reviews:comment_create' review.pk %}" method="POST" >
        <input class="comment-control" type="text" placeholder="ëŒ“ê¸€ ë‹¬ê¸°...">
        <input type="submit" value="ì œì¶œ">
      </form>
    </li>
    {% for comment in hobby.comment_set.all %}
      <li class="comment-elem">
        {% if comment.user.image %}
          <img class="comment-image" src="{{ comment.user.image.url }}" alt="">
        {% else %}
          <img class="comment-image" src="https://dummyimage.com/80x80/000/fff" alt="">
        {% endif %}
        <div>
          <p>{{ comment.user }}</p>
          <p>{{ comment.content }}</p>
          <div>
            <span>{{ comment.created_at|naturaltime }}</span>
          </div>
        </div>
      </li>
    {% endfor %}
  </ul>
  <!-- ë¹„ìŠ·í•œ ì†Œì…œë§ -->
  {{ hobby.tags }}
</div>
{% endblock content %}
{% block js %}
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a296fe5c49ee5c07b18af90b459b38bb&libraries=services"></script>
<script type="text/javascript" src="{% static 'js/hobby_detail.js' %}" ></script>
<!-- ì£¼ì†Œë¡œ ì§€ë„ë„ìš°ê¸° ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  var places = new kakao.maps.services.Places();
  var callback = function(result, status) {
      // ì£¼ì†Œê°€ ìœ íš¨í•  ê²½ìš°
      if (status === kakao.maps.services.Status.OK) {
          console.log(result[0]);
          var mapContainer = document.getElementById('map'),
              mapOption = { 
                  center: new kakao.maps.LatLng(result[0].y, result[0].x),
                  level: 3
              };

          var map = new kakao.maps.Map(mapContainer, mapOption);
          var markerPosition  = new kakao.maps.LatLng(result[0].y, result[0].x); 
          var marker = new kakao.maps.Marker({
              position: markerPosition
          });
          marker.setMap(map);
      }
  };
  // ì£¼ì†Œë¥¼ ì…ë ¥í•˜ë©´ ì½œë°±í•¨ìˆ˜ ì‹¤í–‰
  places.keywordSearch('{{ hobby.address }}', callback);
</script>
{% endblock js %}